"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[255],{942:(e,t,a)=>{function l(){let e=window;if(void 0!==e.__TAURI__||void 0!==e.__TAURI_INTERNALS__||window.navigator.userAgent.includes("Tauri"))return!0;try{if(e.location&&"tauri:"===e.location.protocol)return!0}catch(e){}return"file:"===window.location.protocol||"tauri:"===window.location.protocol}function n(){return{isTauri:l(),isDev:!1,isBuild:!0,userAgent:window.navigator.userAgent,platform:window.navigator.platform}}async function o(){if(l())return!0;try{let{invoke:e}=await a.e(379).then(a.bind(a,7379));if(e)return await e("greet"),!0}catch(e){console.warn("Tauri API test failed:",e)}return!1}async function r(){try{if(await o()){let{invoke:e}=await a.e(379).then(a.bind(a,7379)),{getCurrentWindow:t}=await a.e(381).then(a.bind(a,9381)),l=t();return{invoke:e,currentWindow:l}}}catch(e){console.warn("Failed to import Tauri API:",e)}return{invoke:null,currentWindow:null}}function i(){let e=n();console.log("\uD83D\uDD0D Environment Info:",e),e.isTauri?console.log("✅ Running in Tauri desktop app"):console.log("\uD83C\uDF10 Running in web browser")}a.d(t,{XI:()=>o,cR:()=>n,uL:()=>i,vo:()=>l,xU:()=>r})},1519:(e,t,a)=>{a.d(t,{A:()=>o});var l=a(6354),n=a(942);let o=()=>{let[e,t]=(0,l.useState)(null),[a,o]=(0,l.useState)(!0),[r,i]=(0,l.useState)(!1),[s,c]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(0,n.uL)(),u()},[]);let u=async()=>{let e=await (0,n.XI)();c(e),console.log("\uD83D\uDD0D Tauri环境检测结果: ".concat(e?"✅ 是":"❌ 否")),await d()},d=async()=>{o(!0);try{let{invoke:e}=await (0,n.xU)();if(!s||!e){console.log("\uD83C\uDF10 Web环境：检查localStorage认证状态");let e=localStorage.getItem("auth_user"),a=localStorage.getItem("auth_token"),l=localStorage.getItem("auth_expires");if(e&&a&&l){let a=parseInt(l);if(Date.now()<a){let a=JSON.parse(e);t(a),i(!0),console.log("✅ Web环境：找到有效的认证数据")}else localStorage.removeItem("auth_user"),localStorage.removeItem("auth_token"),localStorage.removeItem("auth_expires"),console.log("⏰ Web环境：认证数据已过期，已清除")}else console.log("❌ Web环境：未找到认证数据");return}console.log("\uD83D\uDDA5️ Tauri环境：检查本地认证状态");let a=await e("get_auth_data");a?(t(a.user),i(!0),console.log("✅ Tauri环境：找到有效的认证数据")):console.log("❌ Tauri环境：未找到认证数据")}catch(e){console.error("❌ 检查认证状态失败:",e)}finally{o(!1)}},g=async()=>{try{let{invoke:e}=await (0,n.xU)();s&&e?(console.log("\uD83D\uDDA5️ Tauri环境：调用logout命令"),await e("logout")):(console.log("\uD83C\uDF10 Web环境：清除认证数据"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_token"),localStorage.removeItem("auth_expires"))}catch(e){console.error("❌ 登出失败:",e)}finally{t(null),i(!1),console.log("✅ 登出成功"),window.location.href="/login"}};return{user:e,isLoading:a,isAuthenticated:r,isTauriEnv:s,login:e=>{t(e),i(!0)},logout:g,checkAuthStatus:d}}},2803:(e,t,a)=>{a.d(t,{c:()=>o});var l=a(8752),n=a(6354);let o=()=>{let e=(0,l.useRouter)(),t=(0,n.useCallback)(t=>{setTimeout(()=>{e.push(t)},0)},[e]);return{navigateTo:t,replace:(0,n.useCallback)(t=>{setTimeout(()=>{e.replace(t)},0)},[e]),back:(0,n.useCallback)(()=>{setTimeout(()=>{e.back()},0)},[e])}}},7176:(e,t,a)=>{a.d(t,{Q:()=>v});var l=a(7770),n=a(6354),o=a(8582),r=a(6907),i=a(9764),s=a(2971),c=a(7710),u=a(9157),d=a(3222),g=a(2109),m=a(8024),h=a(9441),f=a(6198),w=a(6239),x=a(1874);let b=async()=>{try{if(window.__TAURI__){let{invoke:e}=await a.e(379).then(a.bind(a,7379));return e}}catch(e){console.warn("Tauri API not available:",e)}return null},v=e=>{let{onSuccess:t,onLoginSuccess:a,onLogin:v}=e,[_,p]=(0,n.useState)("email"),[S,j]=(0,n.useState)(""),[I,y]=(0,n.useState)(""),[k,T]=(0,n.useState)(!1),[A,z]=(0,n.useState)(0),[D,E]=(0,n.useState)(""),C=async e=>{if(e.preventDefault(),S&&!k){T(!0),E("");try{let e=await b();if(!e){console.log("模拟发送验证码到: ".concat(S)),p("code"),z(60);let e=setInterval(()=>{z(t=>t<=1?(clearInterval(e),0):t-1)},1e3);return}let t=await e("send_verification_code",{email:S});if(t.success){p("code"),z(60);let e=setInterval(()=>{z(t=>t<=1?(clearInterval(e),0):t-1)},1e3)}else E(t.message)}catch(e){console.error("发送验证码失败:",e),E("发送验证码失败，请稍后重试")}finally{T(!1)}}},N=async e=>{if(e.preventDefault(),S&&I&&!k){T(!0),E("");try{let e=await b();if(!e){if("123456"===I){let e={id:"mock-user-id",email:S,name:S.split("@")[0],avatar:void 0};localStorage.setItem("auth_user",JSON.stringify(e)),localStorage.setItem("auth_token","mock-token"),localStorage.setItem("auth_expires",(Date.now()+2592e6).toString()),null==t||t(e),null==a||a(e),null==v||v(e)}else E("验证码错误，请输入 123456");return}let l=await e("verify_code_and_login",{email:S,code:I});l.success&&l.user&&l.token?(await e("save_auth_data",{user:l.user,token:l.token,expiresAt:Date.now()+2592e6}),null==t||t(l.user),null==a||a(l.user),null==v||v(l.user)):E(l.message||"验证失败")}catch(e){console.error("验证码验证失败:",e),E("验证失败，请检查验证码是否正确")}finally{T(!1)}}};return"email"===_?(0,l.jsxs)(o.B,{gap:"md",children:[D&&(0,l.jsx)(r.F,{icon:(0,l.jsx)(h.A,{size:16}),color:"red",variant:"light",radius:"md",children:D}),(0,l.jsx)("form",{onSubmit:C,children:(0,l.jsxs)(o.B,{gap:"md",children:[(0,l.jsx)(i.k,{label:"邮箱地址",placeholder:"请输入您的邮箱地址",value:S,onChange:e=>j(e.currentTarget.value),leftSection:(0,l.jsx)(f.A,{size:16}),required:!0,disabled:k,radius:"md",size:"md",autoFocus:!0}),(0,l.jsx)(s.$,{type:"submit",size:"md",radius:"md",disabled:!S.trim()||k,loading:k,className:"flat-button",children:"发送验证码"})]})}),(0,l.jsx)(c.E,{size:"xs",c:"dimmed",ta:"center",children:"我们将向您的邮箱发送6位数字验证码"})]}):(0,l.jsxs)(o.B,{gap:"md",children:[D&&(0,l.jsx)(r.F,{icon:(0,l.jsx)(h.A,{size:16}),color:"red",variant:"light",radius:"md",children:D}),(0,l.jsxs)(u.t,{p:"md",bg:"blue.0",radius:"md",children:[(0,l.jsx)(c.E,{size:"sm",c:"blue",ta:"center",children:"验证码已发送至"}),(0,l.jsx)(c.E,{fw:600,ta:"center",mt:"xs",children:S})]}),(0,l.jsx)("form",{onSubmit:N,children:(0,l.jsxs)(o.B,{gap:"md",children:[(0,l.jsxs)(o.B,{gap:"xs",align:"center",children:[(0,l.jsx)(c.E,{size:"sm",fw:500,children:"请输入6位验证码"}),(0,l.jsx)(d.c,{value:I,onChange:y,length:6,size:"lg",radius:"md",disabled:k,autoFocus:!0})]}),(0,l.jsx)(s.$,{type:"submit",size:"md",radius:"md",disabled:6!==I.length||k,loading:k,className:"flat-button",children:"验证并登录"})]})}),(0,l.jsx)(g.c,{}),(0,l.jsxs)(m.Y,{justify:"space-between",children:[(0,l.jsx)(s.$,{variant:"subtle",leftSection:(0,l.jsx)(w.A,{size:16}),onClick:()=>{p("email"),y(""),E("")},disabled:k,size:"sm",children:"修改邮箱"}),(0,l.jsx)(s.$,{variant:"subtle",leftSection:(0,l.jsx)(x.A,{size:16}),onClick:()=>{A>0||C(new Event("submit"))},disabled:A>0||k,size:"sm",children:A>0?"".concat(A,"s 后重发"):"重新发送"})]}),!1,(0,l.jsx)(c.E,{size:"xs",c:"dimmed",ta:"center",children:"登录即表示您同意我们的服务条款和隐私政策"})]})}}}]);