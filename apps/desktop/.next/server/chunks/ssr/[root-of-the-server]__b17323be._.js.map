{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///Users/cavatina/projects/aicooper/apps/desktop/src/lib/tauri.ts"],"sourcesContent":["// Tauri 环境检测和工具函数\n\n/**\n * 检查是否在 Tauri 环境中运行\n */\nexport function isTauriApp(): boolean {\n  if (typeof window === 'undefined') return false;\n  \n  // 检查多个Tauri特征\n  const windowAny = window as any;\n  \n  // 方法1: 检查 __TAURI__ 对象\n  if (windowAny.__TAURI__ !== undefined) {\n    return true;\n  }\n  \n  // 方法2: 检查 __TAURI_INTERNALS__ 对象\n  if (windowAny.__TAURI_INTERNALS__ !== undefined) {\n    return true;\n  }\n  \n  // 方法3: 检查用户代理字符串\n  if (window.navigator.userAgent.includes('Tauri')) {\n    return true;\n  }\n  \n  // 方法4: 检查是否有 tauri:// 协议支持\n  try {\n    if (windowAny.location && windowAny.location.protocol === 'tauri:') {\n      return true;\n    }\n  } catch (e) {\n    // 忽略错误\n  }\n  \n  // 方法5: 检查是否在文件协议下运行（Tauri构建后的特征）\n  if (window.location.protocol === 'file:' || window.location.protocol === 'tauri:') {\n    return true;\n  }\n  \n  return false;\n}\n\n/**\n * 检查是否在开发环境中\n */\nexport function isDevelopment(): boolean {\n  return process.env.NODE_ENV === 'development';\n}\n\n/**\n * 检查是否在构建环境中\n */\nexport function isTauriBuild(): boolean {\n  return process.env.TAURI_BUILD === 'true';\n}\n\n/**\n * 获取当前运行环境信息\n */\nexport function getEnvironmentInfo() {\n  return {\n    isTauri: isTauriApp(),\n    isDev: isDevelopment(),\n    isBuild: isTauriBuild(),\n    userAgent: typeof window !== 'undefined' ? window.navigator.userAgent : 'server',\n    platform: typeof window !== 'undefined' ? window.navigator.platform : 'server',\n  };\n}\n\n/**\n * 异步检查是否在 Tauri 环境中运行（更可靠）\n */\nexport async function checkTauriEnvironment(): Promise<boolean> {\n  if (typeof window === 'undefined') return false;\n  \n  // 首先尝试同步检测\n  if (isTauriApp()) {\n    return true;\n  }\n  \n  // 异步检测：尝试导入和使用Tauri API\n  try {\n    const { invoke } = await import('@tauri-apps/api/core');\n    if (invoke) {\n      // 尝试调用一个简单的命令来确认Tauri环境\n      await invoke('greet');\n      return true;\n    }\n  } catch (error) {\n    console.warn('Tauri API test failed:', error);\n  }\n  \n  return false;\n}\n\n/**\n * 安全地导入 Tauri API\n */\nexport async function importTauriApi() {\n  try {\n    // 使用异步检测\n    const isTauri = await checkTauriEnvironment();\n    if (isTauri) {\n      const { invoke } = await import('@tauri-apps/api/core');\n      const { getCurrentWindow } = await import('@tauri-apps/api/window');\n      const currentWindow = getCurrentWindow();\n      return { invoke, currentWindow };\n    }\n  } catch (error) {\n    console.warn('Failed to import Tauri API:', error);\n  }\n  return { invoke: null, currentWindow: null };\n}\n\n/**\n * 显示环境信息（调试用）\n */\nexport function logEnvironmentInfo() {\n  const info = getEnvironmentInfo();\n  console.log('🔍 Environment Info:', info);\n  \n  if (info.isTauri) {\n    console.log('✅ Running in Tauri desktop app');\n  } else {\n    console.log('🌐 Running in web browser');\n  }\n}"],"names":[],"mappings":"AAAA,kBAAkB;AAElB;;CAEC;;;;;;;;;AACM,SAAS;IACd,wCAAmC,OAAO;;;IAE1C,cAAc;IACd,MAAM;AAgCR;AAKO,SAAS;IACd,OAAO,oDAAyB;AAClC;AAKO,SAAS;IACd,OAAO,QAAQ,GAAG,CAAC,WAAW,KAAK;AACrC;AAKO,SAAS;IACd,OAAO;QACL,SAAS;QACT,OAAO;QACP,SAAS;QACT,WAAW,sCAAgC,0BAA6B;QACxE,UAAU,sCAAgC,0BAA4B;IACxE;AACF;AAKO,eAAe;IACpB,wCAAmC,OAAO;;;AAoB5C;AAKO,eAAe;IACpB,IAAI;QACF,SAAS;QACT,MAAM,UAAU,MAAM;QACtB,IAAI,SAAS;YACX,MAAM,EAAE,MAAM,EAAE,GAAG;YACnB,MAAM,EAAE,gBAAgB,EAAE,GAAG;YAC7B,MAAM,gBAAgB;YACtB,OAAO;gBAAE;gBAAQ;YAAc;QACjC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,+BAA+B;IAC9C;IACA,OAAO;QAAE,QAAQ;QAAM,eAAe;IAAK;AAC7C;AAKO,SAAS;IACd,MAAM,OAAO;IACb,QAAQ,GAAG,CAAC,wBAAwB;IAEpC,IAAI,KAAK,OAAO,EAAE;QAChB,QAAQ,GAAG,CAAC;IACd,OAAO;QACL,QAAQ,GAAG,CAAC;IACd;AACF","debugId":null}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///Users/cavatina/projects/aicooper/apps/desktop/src/hooks/useAuth.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { importTauriApi, isTauriApp, checkTauriEnvironment, logEnvironmentInfo } from '@/lib/tauri';\n\ninterface AuthUser {\n  id: string;\n  email: string;\n  name: string;\n  avatar?: string;\n}\n\ninterface AuthData {\n  user: AuthUser;\n  token: string;\n  expires_at: number;\n}\n\nexport const useAuth = () => {\n  const [user, setUser] = useState<AuthUser | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [isTauriEnv, setIsTauriEnv] = useState(false);\n\n  useEffect(() => {\n    // 显示环境信息（调试用）\n    logEnvironmentInfo();\n    initializeAuth();\n  }, []);\n\n  const initializeAuth = async () => {\n    // 首先检测Tauri环境\n    const tauriDetected = await checkTauriEnvironment();\n    setIsTauriEnv(tauriDetected);\n    console.log(`🔍 Tauri环境检测结果: ${tauriDetected ? '✅ 是' : '❌ 否'}`);\n    \n    // 然后检查认证状态\n    await checkAuthStatus();\n  };\n\n  const checkAuthStatus = async () => {\n    setIsLoading(true);\n    try {\n      const { invoke } = await importTauriApi();\n      \n      if (!isTauriEnv || !invoke) {\n        // Web环境下检查localStorage\n        console.log('🌐 Web环境：检查localStorage认证状态');\n        const authUser = localStorage.getItem('auth_user');\n        const authToken = localStorage.getItem('auth_token');\n        const authExpires = localStorage.getItem('auth_expires');\n        \n        if (authUser && authToken && authExpires) {\n          const expiresAt = parseInt(authExpires);\n          if (Date.now() < expiresAt) {\n            const userData = JSON.parse(authUser);\n            setUser(userData);\n            setIsAuthenticated(true);\n            console.log('✅ Web环境：找到有效的认证数据');\n          } else {\n            // 清除过期数据\n            localStorage.removeItem('auth_user');\n            localStorage.removeItem('auth_token');\n            localStorage.removeItem('auth_expires');\n            console.log('⏰ Web环境：认证数据已过期，已清除');\n          }\n        } else {\n          console.log('❌ Web环境：未找到认证数据');\n        }\n        return;\n      }\n\n      // Tauri环境下检查本地存储\n      console.log('🖥️ Tauri环境：检查本地认证状态');\n      const authData = await invoke<AuthData | null>('get_auth_data');\n      if (authData) {\n        setUser(authData.user);\n        setIsAuthenticated(true);\n        console.log('✅ Tauri环境：找到有效的认证数据');\n      } else {\n        console.log('❌ Tauri环境：未找到认证数据');\n      }\n    } catch (error) {\n      console.error('❌ 检查认证状态失败:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = (userData: AuthUser) => {\n    setUser(userData);\n    setIsAuthenticated(true);\n  };\n\n  const logout = async () => {\n    try {\n      const { invoke } = await importTauriApi();\n      \n      if (!isTauriEnv || !invoke) {\n        // Web环境下清除localStorage\n        console.log('🌐 Web环境：清除认证数据');\n        localStorage.removeItem('auth_user');\n        localStorage.removeItem('auth_token');\n        localStorage.removeItem('auth_expires');\n      } else {\n        // Tauri环境下调用logout命令\n        console.log('🖥️ Tauri环境：调用logout命令');\n        await invoke('logout');\n      }\n    } catch (error) {\n      console.error('❌ 登出失败:', error);\n    } finally {\n      setUser(null);\n      setIsAuthenticated(false);\n      console.log('✅ 登出成功');\n      \n      // 退出登录后跳转到登录页面\n      if (typeof window !== 'undefined') {\n        window.location.href = '/login';\n      }\n    }\n  };\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated,\n    isTauriEnv,\n    login,\n    logout,\n    checkAuthStatus,\n  };\n};"],"names":[],"mappings":";;;AAAA;AACA;;;AAeO,MAAM,UAAU;IACrB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,sWAAA,CAAA,WAAQ,AAAD,EAAmB;IAClD,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,sWAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,sWAAA,CAAA,WAAQ,AAAD,EAAE;IACvD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,sWAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,CAAA,GAAA,sWAAA,CAAA,YAAS,AAAD,EAAE;QACR,cAAc;QACd,CAAA,GAAA,sIAAA,CAAA,qBAAkB,AAAD;QACjB;IACF,GAAG,EAAE;IAEL,MAAM,iBAAiB;QACrB,cAAc;QACd,MAAM,gBAAgB,MAAM,CAAA,GAAA,sIAAA,CAAA,wBAAqB,AAAD;QAChD,cAAc;QACd,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,gBAAgB,QAAQ,OAAO;QAE9D,WAAW;QACX,MAAM;IACR;IAEA,MAAM,kBAAkB;QACtB,aAAa;QACb,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAA,GAAA,sIAAA,CAAA,iBAAc,AAAD;YAEtC,IAAI,CAAC,cAAc,CAAC,QAAQ;gBAC1B,uBAAuB;gBACvB,QAAQ,GAAG,CAAC;gBACZ,MAAM,WAAW,aAAa,OAAO,CAAC;gBACtC,MAAM,YAAY,aAAa,OAAO,CAAC;gBACvC,MAAM,cAAc,aAAa,OAAO,CAAC;gBAEzC,IAAI,YAAY,aAAa,aAAa;oBACxC,MAAM,YAAY,SAAS;oBAC3B,IAAI,KAAK,GAAG,KAAK,WAAW;wBAC1B,MAAM,WAAW,KAAK,KAAK,CAAC;wBAC5B,QAAQ;wBACR,mBAAmB;wBACnB,QAAQ,GAAG,CAAC;oBACd,OAAO;wBACL,SAAS;wBACT,aAAa,UAAU,CAAC;wBACxB,aAAa,UAAU,CAAC;wBACxB,aAAa,UAAU,CAAC;wBACxB,QAAQ,GAAG,CAAC;oBACd;gBACF,OAAO;oBACL,QAAQ,GAAG,CAAC;gBACd;gBACA;YACF;YAEA,iBAAiB;YACjB,QAAQ,GAAG,CAAC;YACZ,MAAM,WAAW,MAAM,OAAwB;YAC/C,IAAI,UAAU;gBACZ,QAAQ,SAAS,IAAI;gBACrB,mBAAmB;gBACnB,QAAQ,GAAG,CAAC;YACd,OAAO;gBACL,QAAQ,GAAG,CAAC;YACd;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,eAAe;QAC/B,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,QAAQ,CAAC;QACb,QAAQ;QACR,mBAAmB;IACrB;IAEA,MAAM,SAAS;QACb,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAA,GAAA,sIAAA,CAAA,iBAAc,AAAD;YAEtC,IAAI,CAAC,cAAc,CAAC,QAAQ;gBAC1B,uBAAuB;gBACvB,QAAQ,GAAG,CAAC;gBACZ,aAAa,UAAU,CAAC;gBACxB,aAAa,UAAU,CAAC;gBACxB,aAAa,UAAU,CAAC;YAC1B,OAAO;gBACL,qBAAqB;gBACrB,QAAQ,GAAG,CAAC;gBACZ,MAAM,OAAO;YACf;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,WAAW;QAC3B,SAAU;YACR,QAAQ;YACR,mBAAmB;YACnB,QAAQ,GAAG,CAAC;YAEZ,eAAe;YACf;;QAGF;IACF;IAEA,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 223, "column": 0}, "map": {"version":3,"sources":["file:///Users/cavatina/projects/aicooper/apps/desktop/src/components/auth/LoginForm.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from 'react';\nimport { \n  TextInput, \n  Button, \n  Stack, \n  Text, \n  Alert, \n  Group, \n  PinInput,\n  Paper,\n  Divider,\n  Badge\n} from '@mantine/core';\nimport { \n  IconMail, \n  IconShield, \n  IconArrowLeft, \n  IconRefresh,\n  IconAlertCircle\n} from '@tabler/icons-react';\nimport { notifications } from '@mantine/notifications';\n\n// Safely import Tauri API with fallback\nconst getTauriInvoke = async () => {\n  try {\n    if (typeof window !== 'undefined' && (window as any).__TAURI__) {\n      const { invoke } = await import('@tauri-apps/api/core');\n      return invoke;\n    }\n  } catch (error) {\n    console.warn('Tauri API not available:', error);\n  }\n  return null;\n};\n\ninterface LoginFormProps {\n  onSuccess?: (user: any) => void;\n  onLoginSuccess?: (user: any) => void;\n  onLogin?: (user: any) => void;\n}\n\ninterface AuthResponse {\n  success: boolean;\n  message: string;\n  user?: {\n    id: string;\n    email: string;\n    name: string;\n    avatar?: string;\n  };\n  token?: string;\n}\n\nexport const LoginForm: React.FC<LoginFormProps> = ({ onSuccess, onLoginSuccess, onLogin }) => {\n  const [step, setStep] = useState<'email' | 'code'>('email');\n  const [email, setEmail] = useState('');\n  const [code, setCode] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [countdown, setCountdown] = useState(0);\n  const [error, setError] = useState('');\n\n  const handleSendCode = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email || isLoading) return;\n\n    setIsLoading(true);\n    setError('');\n    \n    try {\n      const invoke = await getTauriInvoke();\n      if (!invoke) {\n        // Web环境下的模拟\n        console.log(`模拟发送验证码到: ${email}`);\n        setStep('code');\n        setCountdown(60);\n        \n        const timer = setInterval(() => {\n          setCountdown((prev) => {\n            if (prev <= 1) {\n              clearInterval(timer);\n              return 0;\n            }\n            return prev - 1;\n          });\n        }, 1000);\n        return;\n      }\n\n      const response = await invoke<{ success: boolean; message: string }>('send_verification_code', {\n        email\n      });\n\n      if (response.success) {\n        setStep('code');\n        setCountdown(60);\n        \n        const timer = setInterval(() => {\n          setCountdown((prev) => {\n            if (prev <= 1) {\n              clearInterval(timer);\n              return 0;\n            }\n            return prev - 1;\n          });\n        }, 1000);\n      } else {\n        setError(response.message);\n      }\n    } catch (error) {\n      console.error('发送验证码失败:', error);\n      setError('发送验证码失败，请稍后重试');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleVerifyCode = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email || !code || isLoading) return;\n\n    setIsLoading(true);\n    setError('');\n    \n    try {\n      const invoke = await getTauriInvoke();\n      if (!invoke) {\n        // Web环境下的模拟\n        if (code === '123456') {\n          const mockUser = {\n            id: 'mock-user-id',\n            email,\n            name: email.split('@')[0],\n            avatar: undefined\n          };\n          \n          // 保存到localStorage\n          localStorage.setItem('auth_user', JSON.stringify(mockUser));\n          localStorage.setItem('auth_token', 'mock-token');\n          localStorage.setItem('auth_expires', (Date.now() + 30 * 24 * 60 * 60 * 1000).toString());\n          \n          // 调用所有回调函数\n          onSuccess?.(mockUser);\n          onLoginSuccess?.(mockUser);\n          onLogin?.(mockUser);\n        } else {\n          setError('验证码错误，请输入 123456');\n        }\n        return;\n      }\n\n      const response = await invoke<AuthResponse>('verify_code_and_login', {\n        email,\n        code\n      });\n\n      if (response.success && response.user && response.token) {\n        // 保存认证信息到本地存储\n        await invoke('save_auth_data', {\n          user: response.user,\n          token: response.token,\n          expiresAt: Date.now() + 30 * 24 * 60 * 60 * 1000 // 30天\n        });\n        \n        // 调用所有回调函数\n        onSuccess?.(response.user);\n        onLoginSuccess?.(response.user);\n        onLogin?.(response.user);\n      } else {\n        setError(response.message || '验证失败');\n      }\n    } catch (error) {\n      console.error('验证码验证失败:', error);\n      setError('验证失败，请检查验证码是否正确');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleResendCode = () => {\n    if (countdown > 0) return;\n    handleSendCode(new Event('submit') as any);\n  };\n\n  const handleBackToEmail = () => {\n    setStep('email');\n    setCode('');\n    setError('');\n  };\n\n  if (step === 'email') {\n    return (\n      <Stack gap=\"md\">\n        {error && (\n          <Alert \n            icon={<IconAlertCircle size={16} />} \n            color=\"red\" \n            variant=\"light\"\n            radius=\"md\"\n          >\n            {error}\n          </Alert>\n        )}\n        \n        <form onSubmit={handleSendCode}>\n          <Stack gap=\"md\">\n            <TextInput\n              label=\"邮箱地址\"\n              placeholder=\"请输入您的邮箱地址\"\n              value={email}\n              onChange={(e) => setEmail(e.currentTarget.value)}\n              leftSection={<IconMail size={16} />}\n              required\n              disabled={isLoading}\n              radius=\"md\"\n              size=\"md\"\n              autoFocus\n            />\n            \n            <Button\n              type=\"submit\"\n              size=\"md\"\n              radius=\"md\"\n              disabled={!email.trim() || isLoading}\n              loading={isLoading}\n              className=\"flat-button\"\n            >\n              发送验证码\n            </Button>\n          </Stack>\n        </form>\n        \n        <Text size=\"xs\" c=\"dimmed\" ta=\"center\">\n          我们将向您的邮箱发送6位数字验证码\n        </Text>\n      </Stack>\n    );\n  }\n\n  return (\n    <Stack gap=\"md\">\n      {error && (\n        <Alert \n          icon={<IconAlertCircle size={16} />} \n          color=\"red\" \n          variant=\"light\"\n          radius=\"md\"\n        >\n          {error}\n        </Alert>\n      )}\n      \n      <Paper p=\"md\" bg=\"blue.0\" radius=\"md\">\n        <Text size=\"sm\" c=\"blue\" ta=\"center\">\n          验证码已发送至\n        </Text>\n        <Text fw={600} ta=\"center\" mt=\"xs\">{email}</Text>\n      </Paper>\n      \n      <form onSubmit={handleVerifyCode}>\n        <Stack gap=\"md\">\n          <Stack gap=\"xs\" align=\"center\">\n            <Text size=\"sm\" fw={500}>请输入6位验证码</Text>\n            <PinInput\n              value={code}\n              onChange={setCode}\n              length={6}\n              size=\"lg\"\n              radius=\"md\"\n              disabled={isLoading}\n              autoFocus\n            />\n          </Stack>\n          \n          <Button\n            type=\"submit\"\n            size=\"md\"\n            radius=\"md\"\n            disabled={code.length !== 6 || isLoading}\n            loading={isLoading}\n            className=\"flat-button\"\n          >\n            验证并登录\n          </Button>\n        </Stack>\n      </form>\n      \n      <Divider />\n      \n      <Group justify=\"space-between\">\n        <Button\n          variant=\"subtle\"\n          leftSection={<IconArrowLeft size={16} />}\n          onClick={handleBackToEmail}\n          disabled={isLoading}\n          size=\"sm\"\n        >\n          修改邮箱\n        </Button>\n        \n        <Button\n          variant=\"subtle\"\n          leftSection={<IconRefresh size={16} />}\n          onClick={handleResendCode}\n          disabled={countdown > 0 || isLoading}\n          size=\"sm\"\n        >\n          {countdown > 0 ? `${countdown}s 后重发` : '重新发送'}\n        </Button>\n      </Group>\n      \n      {/* 开发环境测试 */}\n      {process.env.NODE_ENV === 'development' && (\n        <Paper p=\"xs\" bg=\"gray.0\" radius=\"md\">\n          <Text size=\"xs\" c=\"dimmed\" mb=\"xs\">开发环境测试</Text>\n          <Group gap=\"xs\">\n            <Button\n              size=\"xs\"\n              variant=\"light\"\n              onClick={() => setCode('123456')}\n            >\n              填入测试码\n            </Button>\n            <Button\n              size=\"xs\"\n              variant=\"light\"\n              color=\"gray\"\n              onClick={() => setCode('')}\n            >\n              清空\n            </Button>\n          </Group>\n        </Paper>\n      )}\n      \n      <Text size=\"xs\" c=\"dimmed\" ta=\"center\">\n        登录即表示您同意我们的服务条款和隐私政策\n      </Text>\n    </Stack>\n  );\n};"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 697, "column": 0}, "map": {"version":3,"sources":["file:///Users/cavatina/projects/aicooper/apps/desktop/src/hooks/useNavigation.ts"],"sourcesContent":["import { useRouter } from 'next/navigation';\nimport { useCallback } from 'react';\n\nexport const useNavigation = () => {\n  const router = useRouter();\n\n  const navigateTo = useCallback((path: string) => {\n    // 使用setTimeout来避免在渲染过程中直接调用router.push\n    setTimeout(() => {\n      router.push(path);\n    }, 0);\n  }, [router]);\n\n  const replace = useCallback((path: string) => {\n    setTimeout(() => {\n      router.replace(path);\n    }, 0);\n  }, [router]);\n\n  const back = useCallback(() => {\n    setTimeout(() => {\n      router.back();\n    }, 0);\n  }, [router]);\n\n  return {\n    navigateTo,\n    replace,\n    back,\n  };\n};"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,MAAM,gBAAgB;IAC3B,MAAM,SAAS,CAAA,GAAA,mSAAA,CAAA,YAAS,AAAD;IAEvB,MAAM,aAAa,CAAA,GAAA,sWAAA,CAAA,cAAW,AAAD,EAAE,CAAC;QAC9B,uCAAuC;QACvC,WAAW;YACT,OAAO,IAAI,CAAC;QACd,GAAG;IACL,GAAG;QAAC;KAAO;IAEX,MAAM,UAAU,CAAA,GAAA,sWAAA,CAAA,cAAW,AAAD,EAAE,CAAC;QAC3B,WAAW;YACT,OAAO,OAAO,CAAC;QACjB,GAAG;IACL,GAAG;QAAC;KAAO;IAEX,MAAM,OAAO,CAAA,GAAA,sWAAA,CAAA,cAAW,AAAD,EAAE;QACvB,WAAW;YACT,OAAO,IAAI;QACb,GAAG;IACL,GAAG;QAAC;KAAO;IAEX,OAAO;QACL;QACA;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 738, "column": 0}, "map": {"version":3,"sources":["file:///Users/cavatina/projects/aicooper/apps/desktop/src/components/auth/AuthGuard.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from 'react';\nimport { useAuth } from '@/hooks/useAuth';\nimport { LoginForm } from '@/components/auth/LoginForm';\nimport { \n  Card, \n  Text, \n  Stack, \n  Center, \n  Loader,\n  Box,\n  Title\n} from '@mantine/core';\nimport { IconRobot, IconLock } from '@tabler/icons-react';\nimport { useNavigation } from '@/hooks/useNavigation';\n\ninterface AuthGuardProps {\n  children: React.ReactNode;\n  fallback?: React.ReactNode;\n}\n\nexport const AuthGuard: React.FC<AuthGuardProps> = ({ \n  children, \n  fallback \n}) => {\n  const { isAuthenticated, isLoading, login } = useAuth();\n  const { navigateTo } = useNavigation();\n  const [showLogin, setShowLogin] = useState(false);\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      // 如果未登录，重定向到登录页面\n      if (typeof window !== 'undefined' && window.location.pathname !== '/login') {\n        navigateTo('/login');\n        return;\n      }\n      \n      if (!fallback) {\n        setShowLogin(true);\n      }\n    }\n  }, [isLoading, isAuthenticated, fallback, navigateTo]);\n\n  const handleLoginSuccess = (user: any) => {\n    login(user);\n    setShowLogin(false);\n    // 登录成功后跳转到主页\n    navigateTo('/');\n  };\n\n  if (isLoading) {\n    return (\n      <Center h=\"100vh\" bg=\"gray.0\">\n        <Card shadow=\"sm\" padding=\"xl\" radius=\"md\" withBorder>\n          <Stack align=\"center\" gap=\"md\">\n            <Loader size=\"lg\" />\n            <Text c=\"dimmed\">检查登录状态...</Text>\n          </Stack>\n        </Card>\n      </Center>\n    );\n  }\n\n  if (!isAuthenticated) {\n    if (fallback) {\n      return <>{fallback}</>;\n    }\n    \n    if (showLogin) {\n      return (\n        <Center h=\"100vh\" bg=\"gray.0\" p=\"md\">\n          <Box maw={400} w=\"100%\">\n            <Stack align=\"center\" gap=\"xl\">\n              <Stack align=\"center\" gap=\"md\">\n                <IconRobot size={64} color=\"#228be6\" />\n                <Title order={2} ta=\"center\">AI Desktop</Title>\n                <Text c=\"dimmed\" ta=\"center\">\n                  使用邮箱验证码快速登录或注册\n                </Text>\n              </Stack>\n              \n              <Card shadow=\"sm\" padding=\"xl\" radius=\"md\" withBorder w=\"100%\">\n                <LoginForm \n                  onLoginSuccess={handleLoginSuccess}\n                  onLogin={login}\n                />\n              </Card>\n            </Stack>\n          </Box>\n        </Center>\n      );\n    }\n    \n    return (\n      <Center h=\"100vh\" bg=\"gray.0\">\n        <Card shadow=\"sm\" padding=\"xl\" radius=\"md\" withBorder>\n          <Stack align=\"center\" gap=\"md\">\n            <IconLock size={48} color=\"var(--mantine-color-gray-5)\" />\n            <Text c=\"dimmed\">需要登录才能访问</Text>\n          </Stack>\n        </Card>\n      </Center>\n    );\n  }\n\n  return <>{children}</>;\n};"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AACA;AAfA;;;;;;;;AAsBO,MAAM,YAAsC,CAAC,EAClD,QAAQ,EACR,QAAQ,EACT;IACC,MAAM,EAAE,eAAe,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,0IAAA,CAAA,UAAO,AAAD;IACpD,MAAM,EAAE,UAAU,EAAE,GAAG,CAAA,GAAA,gJAAA,CAAA,gBAAa,AAAD;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,sWAAA,CAAA,WAAQ,AAAD,EAAE;IAE3C,CAAA,GAAA,sWAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,CAAC,aAAa,CAAC,iBAAiB;YAClC,iBAAiB;YACjB;;YAKA,IAAI,CAAC,UAAU;gBACb,aAAa;YACf;QACF;IACF,GAAG;QAAC;QAAW;QAAiB;QAAU;KAAW;IAErD,MAAM,qBAAqB,CAAC;QAC1B,MAAM;QACN,aAAa;QACb,aAAa;QACb,WAAW;IACb;IAEA,IAAI,WAAW;QACb,qBACE,+YAAC,qZAAA,CAAA,SAAM;YAAC,GAAE;YAAQ,IAAG;sBACnB,cAAA,+YAAC,iZAAA,CAAA,OAAI;gBAAC,QAAO;gBAAK,SAAQ;gBAAK,QAAO;gBAAK,UAAU;0BACnD,cAAA,+YAAC,mZAAA,CAAA,QAAK;oBAAC,OAAM;oBAAS,KAAI;;sCACxB,+YAAC,qZAAA,CAAA,SAAM;4BAAC,MAAK;;;;;;sCACb,+YAAC,iZAAA,CAAA,OAAI;4BAAC,GAAE;sCAAS;;;;;;;;;;;;;;;;;;;;;;IAK3B;IAEA,IAAI,CAAC,iBAAiB;QACpB,IAAI,UAAU;YACZ,qBAAO;0BAAG;;QACZ;QAEA,IAAI,WAAW;YACb,qBACE,+YAAC,qZAAA,CAAA,SAAM;gBAAC,GAAE;gBAAQ,IAAG;gBAAS,GAAE;0BAC9B,cAAA,+YAAC,yYAAA,CAAA,MAAG;oBAAC,KAAK;oBAAK,GAAE;8BACf,cAAA,+YAAC,mZAAA,CAAA,QAAK;wBAAC,OAAM;wBAAS,KAAI;;0CACxB,+YAAC,mZAAA,CAAA,QAAK;gCAAC,OAAM;gCAAS,KAAI;;kDACxB,+YAAC,sTAAA,CAAA,YAAS;wCAAC,MAAM;wCAAI,OAAM;;;;;;kDAC3B,+YAAC,mZAAA,CAAA,QAAK;wCAAC,OAAO;wCAAG,IAAG;kDAAS;;;;;;kDAC7B,+YAAC,iZAAA,CAAA,OAAI;wCAAC,GAAE;wCAAS,IAAG;kDAAS;;;;;;;;;;;;0CAK/B,+YAAC,iZAAA,CAAA,OAAI;gCAAC,QAAO;gCAAK,SAAQ;gCAAK,QAAO;gCAAK,UAAU;gCAAC,GAAE;0CACtD,cAAA,+YAAC,0JAAA,CAAA,YAAS;oCACR,gBAAgB;oCAChB,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;QAOvB;QAEA,qBACE,+YAAC,qZAAA,CAAA,SAAM;YAAC,GAAE;YAAQ,IAAG;sBACnB,cAAA,+YAAC,iZAAA,CAAA,OAAI;gBAAC,QAAO;gBAAK,SAAQ;gBAAK,QAAO;gBAAK,UAAU;0BACnD,cAAA,+YAAC,mZAAA,CAAA,QAAK;oBAAC,OAAM;oBAAS,KAAI;;sCACxB,+YAAC,oTAAA,CAAA,WAAQ;4BAAC,MAAM;4BAAI,OAAM;;;;;;sCAC1B,+YAAC,iZAAA,CAAA,OAAI;4BAAC,GAAE;sCAAS;;;;;;;;;;;;;;;;;;;;;;IAK3B;IAEA,qBAAO;kBAAG;;AACZ","debugId":null}},
    {"offset": {"line": 976, "column": 0}, "map": {"version":3,"sources":["file:///Users/cavatina/projects/aicooper/apps/desktop/src/app/layout.tsx"],"sourcesContent":["'use client';\n\nimport { MantineProvider, createTheme } from '@mantine/core';\nimport { Notifications } from '@mantine/notifications';\nimport { usePathname } from 'next/navigation';\nimport \"./globals.css\";\nimport { AuthGuard } from \"@/components/auth/AuthGuard\";\n\nconst theme = createTheme({\n  primaryColor: 'blue',\n  fontFamily: '-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif',\n  headings: {\n    fontFamily: '-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif',\n    fontWeight: '600',\n  },\n  radius: {\n    xs: '4px',\n    sm: '6px',\n    md: '8px',\n    lg: '12px',\n    xl: '16px',\n  },\n  shadows: {\n    xs: '0 1px 3px rgba(0, 0, 0, 0.05)',\n    sm: '0 1px 3px rgba(0, 0, 0, 0.1)',\n    md: '0 4px 12px rgba(0, 0, 0, 0.1)',\n    lg: '0 8px 24px rgba(0, 0, 0, 0.12)',\n    xl: '0 12px 32px rgba(0, 0, 0, 0.15)',\n  },\n  colors: {\n    gray: [\n      '#fafafa',\n      '#f4f4f5',\n      '#e4e4e7',\n      '#d4d4d8',\n      '#a1a1aa',\n      '#71717a',\n      '#52525b',\n      '#3f3f46',\n      '#27272a',\n      '#18181b',\n    ],\n  },\n});\n\nfunction LayoutContent({ children }: { children: React.ReactNode }) {\n  const pathname = usePathname();\n  const isLoginPage = pathname === '/login';\n\n  if (isLoginPage) {\n    return <>{children}</>;\n  }\n\n  return (\n    <AuthGuard>\n      {children}\n    </AuthGuard>\n  );\n}\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"zh-CN\">\n      <body>\n        <MantineProvider theme={theme}>\n          <Notifications position=\"top-right\" />\n          <LayoutContent>\n            {children}\n          </LayoutContent>\n        </MantineProvider>\n      </body>\n    </html>\n  );\n}"],"names":[],"mappings":";;;;AAEA;AAAA;AACA;AACA;AAEA;AANA;;;;;;;AAQA,MAAM,QAAQ,CAAA,GAAA,obAAA,CAAA,cAAW,AAAD,EAAE;IACxB,cAAc;IACd,YAAY;IACZ,UAAU;QACR,YAAY;QACZ,YAAY;IACd;IACA,QAAQ;QACN,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;IACN;IACA,SAAS;QACP,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;IACN;IACA,QAAQ;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;IACH;AACF;AAEA,SAAS,cAAc,EAAE,QAAQ,EAAiC;IAChE,MAAM,WAAW,CAAA,GAAA,mSAAA,CAAA,cAAW,AAAD;IAC3B,MAAM,cAAc,aAAa;IAEjC,IAAI,aAAa;QACf,qBAAO;sBAAG;;IACZ;IAEA,qBACE,+YAAC,0JAAA,CAAA,YAAS;kBACP;;;;;;AAGP;AAEe,SAAS,WAAW,EACjC,QAAQ,EAGT;IACC,qBACE,+YAAC;QAAK,MAAK;kBACT,cAAA,+YAAC;sBACC,cAAA,+YAAC,iaAAA,CAAA,kBAAe;gBAAC,OAAO;;kCACtB,+YAAC,iXAAA,CAAA,gBAAa;wBAAC,UAAS;;;;;;kCACxB,+YAAC;kCACE;;;;;;;;;;;;;;;;;;;;;;AAMb","debugId":null}}]
}