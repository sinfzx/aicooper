# IdeaVerify 任务清单（桌面端优先 + 仅广场上行）

说明：本清单对齐 `docs/ideaverify.md`，坚持“桌面端本地分析/存储为主，API 仅支持需求广场，AI 服务桌面直连第三方”。每条任务尽量包含【目标】【实现要点】【验收标准】三段，便于并行推进与验收。

---

## 0. 信息架构（IA / 页面与关键组件）

- 页面（Next.js 路由建议）

  - `/ideas`（创意管理列表）
    - 展示用户本地的创意卡（Idea）与分析状态；支持搜索/筛选（类别、阶段）。
  - `/ideas/new`（创意创建与导入向导）
    - 表单创建 Idea；批量导入来源 URL；可选择立即启动分析流水线。
  - `/ideas/[id]`（创意详情工作台）
    - 分区：基本信息卡片 | 来源与抓取 | 流水线进度 | 需求卡列表 | 评分仪表盘 | 证据折叠面板 | （可选）发布到广场弹窗。
  - `/square`（需求广场列表）
    - 展示已发布的需求卡（仅 API 提供的 public 帖）；支持排序（时间/热度）与分页。
  - `/square/[id]`（广场帖详情）
    - 展示单帖详情（标题、精简需求内容、引用摘要、投票数、评论计数）；支持点赞/取消。
  - `/settings/ideaverify`（分析参数设置）
    - 分析参数（行业、目标市场、预算、团队能力等）；桌面端本地保存；Web 环境 tRPC settings 兜底。

- 关键组件（features/ideaverify/src/components）

  - `IdeaForm`（创意创建/编辑表单）
  - `SourceImporter`（来源导入器：URL 列表、抓取计划）
  - `PipelineRunner`（流水线执行与进度：抓取 → 清洗 → 聚类 → 抽取 → 评分）
  - `DemandCard`（需求卡项：痛点、标签、引用、来源）
  - `RatingRadar`（评分雷达图）
  - `EvidencePanel`（证据折叠：引用片段+来源链接+时间）
  - `PersonaCard`（用户画像/虚拟访谈）
  - `CompetitorMatrix`（竞品功能差异矩阵）
  - `TrendChart`（趋势/主题漂移）
  - `SquarePublishModal`（发布到广场：字段白名单校验、可见性确认）
  - `VisibilityConfirmDialog`（公开可见二次确认）

- 典型用户流（工作台）
  1. 新建 Idea → 导入 URL → 启动流水线（可部分阶段执行）。
  2. 查看需求卡与评分 → 修订（标签/引用） → 导出报告。
  3. 选择部分需求卡 → 发布至广场（可见性确认、字段白名单过滤）。

---

## 1. 架构与边界固化

- [ ] 明确边界与约束
  - 目标：固化桌面端优先、AI 直连、仅广场上行的“红线”。
  - 要点：
    - 在 `docs/specs.md` 与 `.cursor/rules` 中补充 IdeaVerify 专属约束，与 memory 保持一致策略。
    - API 层无任何生成类端点，若有占位路由返回 410。
  - 验收：规则文档更新；API 路由检查无生成端点；桌面端具备直连与本地存储能力。

---

## 2. 数据模型与迁移（Prisma 6，仅广场最小表）

- [ ] 概念模型落库
  - 目标：在 `apps/api/prisma/schema.prisma` 增加广场最小集合。
  - 要点：
    - `SquarePost`：id, userId, title, demandPayload(Json: id/title/painPoint/tags/quotes/sources/score), visibility('public'|'hidden'), upvotes, commentsCount, createdAt, updatedAt。
    - `SquareVote`(可选)：postId, userId, value(1|-1), createdAt（用于幂等与热度排序）。
  - 验收：`prisma migrate dev -n add_ideaverify_square` 通过；`prisma validate` 通过。

---

## 3. API（tRPC 11，仅需求广场）

- [ ] 新建 `ideaverifyRouter`（square.\*）
  - 目标：在 `apps/api/src/server/api/routers/ideaverify.ts` 提供 Square 相关接口。
  - 要点：
    - `square.list`：输入（page/pageSize/sortBy:'time'|'hot'），输出（items/total/hasMore）。仅返回 visibility=public。
    - `square.get`：输入（id），输出（post；评论计数可选）。
    - `square.publish`：输入（精简需求卡白名单字段、来源摘要、visibility），需要二次确认（由前端弹窗确保）。
    - `square.vote`：输入（postId，value 1|-1）；幂等处理（更新或删除 Vote）。
    - `square.delete`：仅作者可删除或隐藏。
    - 全部 `protectedProcedure` + Zod 校验 + superjson。
  - 验收：联调通过；鉴权/权限/参数错误返回 401/403/422；分页/排序正确。

---

## 4. 桌面端分析流水线（Tauri，本地存储）

- [ ] 抓取导入
  - 目标：从 Reddit/HN/PH/自定义 URL 导入公开帖子正文与顶级评论。
  - 要点：速率限制/重试、错误日志；支持手动粘贴片段；可选截图 OCR 占位。
  - 验收：导入多个 URL 成功；失败可重试；日志本地可查。
- [ ] 清洗与去噪
  - 目标：去重、去引用链、语言检测、脱敏（隐私字段过滤）。
  - 要点：关键词/正则；语言识别（库或 LLM）；敏感模式黑名单。
  - 验收：清洗前后差异可视化；隐私字段不进入后续结构化。
- [ ] 主题聚类与需求簇
  - 目标：聚类出 3–8 个主题簇，输出关键词与代表引述。
  - 要点：HDBSCAN/KMeans + LLM 标签重写；簇内一致性阈值；噪声簇剔除。
  - 验收：簇标签可解释；一致性 ≥ 0.6。
- [ ] 痛点抽取 → 需求卡
  - 目标：从簇中抽取“痛点/疑虑/对比点/形态标签/画像线索/来源链接”，形成 `DemandCard`。
  - 要点：提示词模板（多语言/参数注入）；输出字段：id/title/painPoint/tags[]/quotes[]/sources[]/priority。
  - 验收：每个主题簇 1–3 张卡；引用与来源可追溯（链接+时间）。
- [ ] 多维评分与建议
  - 目标：按维度评分与合成建议（MVP/下一步实验）。
  - 要点：可解释启发式 + LLM 辅助；覆盖“市场痛点/竞争强度/技术与商业可行性/增长/合规/护城河/执行难度”。
  - 验收：雷达图渲染；每维度附证据；置信度 0–1。

---

## 5. AI/提示词与服务封装（桌面直连）

- [ ] 提示词模板
  - 目标：在 `features/ideaverify/src/prompts` 建立模板集：摘要、聚类标签建议、痛点抽取、评分、第一性推理、建议合成。
  - 要点：参数化（行业、目标市场、预算、团队能力）；输出 JSON Schema；中英支持。
  - 验收：本地注入参数后结果字段完整；边界情况报错可读。
- [ ] 服务封装/鲁棒性
  - 目标：封装 `fetchWithTimeout`、`withRetry`、简易 Token 桶限流；提供商选择与错误分层（用户可读/开发诊断）。
  - 要点：本地日志落盘（info/warn/error）；请求/响应摘要记录；敏感字段打码。
  - 验收：100 次连续调用稳定；错误有友好提示与日志。

---

## 6. 前端交互与页面实现

- [ ] `/ideas` 列表页
  - 目标：展示本地 Idea 列表与分析状态、搜索/筛选；快捷进入详情。
  - 要点：本地存储（SQLite/JSON）；状态徽标（未分析/进行中/已完成）。
  - 验收：加载 < 300ms；分页/筛选正常。
- [ ] `/ideas/new` 向导页
  - 目标：创建 Idea + 批量导入 URL；可一键启动流水线。
  - 要点：表单验证（Zod）；导入进度/失败重试。
  - 验收：创建/导入/启动三步流顺畅。
- [ ] `/ideas/[id]` 详情工作台
  - 目标：承载全流程操作与结果展示。
  - 要点：分区布局（信息|来源|流水线|需求卡|评分|证据）；导出（JSON/MD/PDF 占位）；发布到广场弹窗（白名单检查+二次确认）。
  - 验收：完整跑通一条分析链；导出包含引用清单；发布上行仅白名单字段。
- [ ] `/square` 与 `/square/[id]`
  - 目标：只读列表与详情；支持点赞/取消；（评论占位）。
  - 要点：tRPC 对接；排序（时间/热度）；分页。
  - 验收：联调通过；非公开不展示。
- [ ] `/settings/ideaverify`
  - 目标：本地参数设置，Web 兜底 tRPC settings。
  - 要点：与桌面端本地设置互通；字段校验；即时生效。
  - 验收：修改参数对提示词链路生效。

---

## 7. 权限、合规与隐私

- [ ] 可见性
  - 目标：私有/公开；广场发帖强制二次确认。
  - 要点：仅上行精简字段（白名单）；提供撤稿/隐藏；审计日志。
  - 验收：权限切换正确；广场仅展示 public。
- [ ] 合规与伦理
  - 目标：尊重平台 ToS 与隐私；透明披露 AI 参与与不确定性。
  - 要点：引用标注来源与时间；撤稿/屏蔽机制；置信度显示与偏见提示。
  - 验收：导出报告含引用清单；隐私字段不过界。

---

## 8. 设置与参数注入

- [ ] 本地设置（桌面端优先）
  - 目标：行业、目标市场、预算、团队能力等参数注入分析链路。
  - 要点：桌面端本地保存；Web 通过 tRPC settings 兜底（仅非敏感字段）。
  - 验收：参数调整对分析结果有可验证影响。

---

## 9. 质量保障与可观测性

- [ ] 测试与指标
  - 目标：tRPC 输入校验与鉴权单测；聚类/抽取链路抽检。
  - 要点：Mock 数据；关键用例 > 20；性能（常规查询 < 300ms）。
  - 验收：CI 通过；回归用例稳定。
- [ ] 日志与审计
  - 目标：外部请求与关键决策日志落盘（桌面端）；API 侧审计（广场操作）。
  - 要点：分级日志（info/warn/error）；隐私打码；日志轮转策略。
  - 验收：故障可追溯；不泄露隐私。

---

## 10. 里程碑拆分

- [ ] M1（MVP）
  - 创意管理与来源导入、基础清洗、簇级痛点抽取、一级评分、报告导出（JSON/MD）。
  - 需求广场只读（列表/详情）。
- [ ] M2
  - 主题聚类稳定化、画像/竞品/趋势页、需求广场发布/投票、可视化完善。
- [ ] M3
  - 买断/悬赏占位、增长管理（社区/KOL/SEO/AIEO）、权限完善。

---

备注：始终坚持“桌面端优先 + AI 直连 + 仅上行广场所需元数据”的红线；所有输入/上行字段经 Zod 白名单校验，严禁媒体与长文本原文进入服务端。
